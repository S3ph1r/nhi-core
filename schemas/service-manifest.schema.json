{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://nhi-core/schemas/service-manifest.schema.json",
  "title": "NHI Service Manifest",
  "description": "Schema for NHI service registry manifests",
  "type": "object",
  "required": ["service", "deployment", "health", "owner", "status"],
  "properties": {
    "service": {
      "type": "object",
      "required": ["name", "description", "version"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Service identifier (lowercase, hyphenated)"
        },
        "description": {
          "type": "string",
          "minLength": 10,
          "description": "What the service does"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "Semantic version (e.g., 1.0.0)"
        }
      }
    },
    "deployment": {
      "type": "object",
      "required": ["type", "lxc_id", "ip", "ports"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["docker", "systemd", "native"],
          "description": "Deployment method"
        },
        "lxc_id": {
          "type": "integer",
          "minimum": 100,
          "maximum": 999,
          "description": "Proxmox LXC container ID"
        },
        "ip": {
          "type": "string",
          "pattern": "^192\\.168\\.[0-9]+\\.[0-9]+$",
          "description": "Service IP address"
        },
        "ports": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1,
            "maximum": 65535
          },
          "minItems": 1,
          "description": "Exposed ports"
        }
      }
    },
    "health": {
      "type": "object",
      "required": ["endpoint"],
      "properties": {
        "endpoint": {
          "type": "string",
          "pattern": "^/.*$",
          "description": "Health check path (e.g., /health)"
        },
        "interval": {
          "type": "string",
          "pattern": "^[0-9]+s$",
          "default": "30s",
          "description": "Check interval"
        },
        "timeout": {
          "type": "string",
          "pattern": "^[0-9]+s$",
          "default": "10s",
          "description": "Check timeout"
        }
      }
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Required services"
    },
    "owner": {
      "type": "string",
      "default": "ai-agent",
      "description": "Responsible user"
    },
    "status": {
      "type": "string",
      "enum": ["active", "maintenance", "deprecated"],
      "description": "Service status"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created": {
          "type": "string",
          "format": "date",
          "description": "Creation date"
        },
        "updated": {
          "type": "string",
          "format": "date",
          "description": "Last update date"
        },
        "repository": {
          "type": "string",
          "format": "uri",
          "description": "Git repository URL"
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "Documentation URL"
        }
      }
    }
  }
}
